
## Документация к скрипту автоматического отслеживания изменений в PostgreSQL с использованием MLflow

### Описание

Этот скрипт предназначен для автоматического отслеживания и логирования изменений в таблице `test_data3` базы данных PostgreSQL. При обнаружении изменений скрипт сохраняет метрики и данные в MLflow, а также экспортирует данные в формате Excel.

### Предварительные требования

- PostgreSQL
- MLflow
- Python (с установленными библиотеками: `time`, `mlflow`, `pandas`, `sqlalchemy`, `os`, `tempfile`, `subprocess`)

### Функции

1. **save_csv_to_postgresql(csv_filename, db_url, table_name)**
   Сохраняет CSV-файл в базе данных PostgreSQL.
   
2. **save_mlflow_data_to_excel(experiment_id, output_filename)**
   Сохраняет метрики MLflow в файл Excel.

3. **log_dataframe_as_artifact(data, artifact_name)**
   Логирует DataFrame в MLflow в качестве артефакта.

4. **log_change_and_metrics_to_excel(change, data)**
   Записывает информацию об изменениях и метриках в файл Excel.

### Установка и запуск

1. Убедитесь, что у вас установлены все необходимые библиотеки и инструменты.
2. Настройте соединение с базой данных PostgreSQL, указав корректные параметры в строке подключения.
3. Запустите скрипт.

### Пример использования

После запуска скрипта он автоматически начнет отслеживать изменения в таблице `test_data3`. Как только обнаружатся изменения, скрипт сохранит соответствующие метрики и данные.

### Настройка триггера и функции в PostgreSQL

#### Создание функции

Перед созданием триггера вам нужно создать функцию, которая будет вызываться триггером при определенном событии:

```sql
CREATE OR REPLACE FUNCTION log_change()
...
```

#### Создание триггера

После создания функции вы можете создать триггер:

- **INSERT**:
```sql
CREATE TRIGGER changes_after_insert
...
```

- **UPDATE**:
```sql
CREATE TRIGGER changes_after_update
...
```

- **DELETE**:
```sql
CREATE TRIGGER changes_after_delete
...
```

#### Проверка работы

Выполните операции INSERT, UPDATE или DELETE в таблице `test_data3` и убедитесь, что функция `log_change` корректно логирует эти события.

---

